\ProvidesPackage{_ref}

\newif\if@ref@bib@is \@ref@bib@isfalse
\DeclareOption{bib}{\@ref@bib@istrue}

\ProcessOptions\relax

\usepackage{xr}
\usepackage{hyperref}

\hypersetup{
    colorlinks=true,
    linkcolor=linkC,
    filecolor=fileC,      
    urlcolor=urlC,
    citecolor = defC,
}

\renewcommand{\sectionautorefname}{\S}
\renewcommand{\subsectionautorefname}{\S}
\renewcommand{\subsubsectionautorefname}{\S}

\numberwithin{equation}{section}

\if@ref@bib@is
    \usepackage[
        style=apa,
        bibstyle=authoryear, 
        backend=biber
    ]{biblatex}
    \addbibresource{refs.bib}
\fi

\let\oldautoref\autoref
\renewcommand{\autoref}[2][]{%
    \oldautoref{#1-#2} (\hrefpdf{#1})%
}

\newcommand{\thmref}[2][]{%
    \ifthenelse{\equal{#1}{}} {%
        \nameref{#2} {(\oldautoref{#2})}%
    }{%
        \nameref{#1-#2} (\oldautoref{#1-#2}, \hrefpdf{#1})%
    }%
}

\newcommand{\sideref}[2][]{%
    \ifthenelse{\equal{#1}{}} {%
        \hfill[\oldautoref{#2}]%
    }{%
        \hfill[\oldautoref{#1-#2}, \hrefpdf{#1}]%
    }%
}

\newcommand{\hrefpdf}[1]{%
    \expandafter\href{run:\csname #1pdf\endcsname}{#1}%
}
\newcommand{\externaldoc}[2]{
    \externaldocument[#1-]{#2}
    \expandafter\def\csname #1pdf\endcsname{#2.pdf}
}
